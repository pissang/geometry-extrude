!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).geometryExtrude={})}(this,function(e){"use strict";var t={exports:{}};function n(e,t,n){n=n||2;var r,i,o,a,v,h,u,l=t&&t.length,x=l?t[0]*n:e.length,f=c(e,0,x,n,!0),s=[];if(!f||f.next===f.prev)return s;if(l&&(f=function(e,t,n,r){var i,o,a,v,h,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,v=i<o-1?t[i+1]*r:e.length,(h=c(e,a,v,r,!1))===h.next&&(h.steiner=!0),u.push(b(h));for(u.sort(g),i=0;i<u.length;i++)n=y(n=m(u[i],n),n.next);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<x;p+=n)(v=e[p])<r&&(r=v),(h=e[p+1])<i&&(i=h),o<v&&(o=v),a<h&&(a=h);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return d(f,s,n,r,i,u),s}function c(e,t,n,r,i){var o,a;if(i===0<q(e,t,n,r))for(o=t;o<n;o+=r)a=v(o,e[o],e[o+1],a);else for(o=n-r;t<=o;o-=r)a=v(o,e[o],e[o+1],a);return a&&p(a,a.next)&&(A(a),a=a.next),a}function y(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!p(r,r.next)&&0!==S(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function d(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;for(;null===i.z&&(i.z=M(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,v,h,u=1;do{for(n=e,o=e=null,a=0;n;){for(a++,r=n,t=v=0;t<u&&(v++,r=r.nextZ);t++);for(h=u;0<v||0<h&&r;)0!==v&&(0===h||!r||n.z<=r.z)?(n=(i=n).nextZ,v--):(r=(i=r).nextZ,h--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(1<a)}(i)}(e,r,i,o);for(var v,h,u=e;e.prev!==e.next;)if(v=e.prev,h=e.next,o?x(e,r,i,o):l(e))t.push(v.i/n),t.push(e.i/n),t.push(h.i/n),A(e),e=h.next,u=h.next;else if((e=h)===u){a?1===a?d(e=f(y(e),t,n),t,n,r,i,o,2):2===a&&s(e,t,n,r,i,o):d(y(e),t,n,r,i,o,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(0<=S(t,n,r))return!1;for(var i=e.next.next;i!==e.prev;){if(w(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=S(i.prev,i,i.next))return!1;i=i.next}return!0}function x(e,t,n,r){var i=e.prev,o=e,a=e.next;if(0<=S(i,o,a))return!1;for(var v=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,h=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,x=M(v,h,t,n,r),f=M(u,l,t,n,r),s=e.prevZ,p=e.nextZ;s&&s.z>=x&&p&&p.z<=f;){if(s!==e.prev&&s!==e.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y)&&0<=S(s.prev,s,s.next))return!1;if(s=s.prevZ,p!==e.prev&&p!==e.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=S(p.prev,p,p.next))return!1;p=p.nextZ}for(;s&&s.z>=x;){if(s!==e.prev&&s!==e.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y)&&0<=S(s.prev,s,s.next))return!1;s=s.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=S(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function f(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!p(i,o)&&Z(i,r,r.next,o)&&z(i,o)&&z(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),A(r),A(r.next),r=e=o),r=r.next}while(r!==e);return y(r)}function s(e,t,n,r,i,o){var a,v,h=e;do{for(var u=h.next.next;u!==h.prev;){if(h.i!==u.i&&(v=u,(a=h).next.i!==v.i&&a.prev.i!==v.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Z(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(a,v)&&(z(a,v)&&z(v,a)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(a,v)&&(S(a.prev,a,v.prev)||S(a,v.prev,v))||p(a,v)&&0<S(a.prev,a,a.next)&&0<S(v.prev,v,v.next)))){var l=R(h,u);return h=y(h,h.next),l=y(l,l.next),d(h,t,n,r,i,o),void d(l,t,n,r,i,o)}u=u.next}h=h.next}while(h!==e)}function g(e,t){return e.x-t.x}function m(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var v=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(v<=i&&a<v){if((a=v)===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var h,u=n,l=n.x,x=n.y,f=1/0;r=n;for(;i>=r.x&&r.x>=l&&i!==r.x&&w(o<x?i:a,o,l,x,o<x?a:i,o,r.x,r.y)&&(h=Math.abs(o-r.y)/(i-r.x),z(r,e)&&(h<f||h===f&&(r.x>n.x||r.x===n.x&&(p=r,S((s=n).prev,s,p.prev)<0&&S(p.next,s,s.next)<0)))&&(n=r,f=h)),r=r.next,r!==u;);var s,p;return n}(e,t);if(!n)return t;var r=R(n,e),i=y(n,n.next);return y(r,r.next),t===n?i:t}function M(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e){for(var t=e,n=e;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n}function w(e,t,n,r,i,o,a,v){return 0<=(i-a)*(t-v)-(e-a)*(o-v)&&0<=(e-a)*(r-v)-(n-a)*(t-v)&&0<=(n-a)*(o-v)-(i-a)*(r-v)}function S(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function p(e,t){return e.x===t.x&&e.y===t.y}function Z(e,t,n,r){var i=u(S(e,t,n)),o=u(S(e,t,r)),a=u(S(n,r,e)),v=u(S(n,r,t));return i!==o&&a!==v||(!(0!==i||!h(e,n,t))||(!(0!==o||!h(e,r,t))||(!(0!==a||!h(n,e,r))||!(0!==v||!h(n,t,r)))))}function h(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function u(e){return 0<e?1:e<0?-1:0}function z(e,t){return S(e.prev,e,e.next)<0?0<=S(e,t,e.next)&&0<=S(e,e.prev,t):S(e,t,e.prev)<0||S(e,e.next,t)<0}function R(e,t){var n=new a(e.i,e.x,e.y),r=new a(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(n.next=i).prev=n,(r.next=n).prev=r,(o.next=r).prev=o,r}function v(e,t,n,r){var i=new a(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i).next=i,i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function a(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}t.exports=n,(t.exports.default=n).deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(q(e,0,o,n));if(i)for(var v=0,h=t.length;v<h;v++){var u=t[v]*n,l=v<h-1?t[v+1]*n:e.length;a-=Math.abs(q(e,u,l,n))}var x=0;for(v=0;v<r.length;v+=3){var f=r[v]*n,s=r[v+1]*n,p=r[v+2]*n;x+=Math.abs((e[f]-e[p])*(e[s+1]-e[f+1])-(e[f]-e[s])*(e[p+1]-e[f+1]))}return 0===a&&0===x?0:Math.abs((x-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);0<i&&(r+=e[i-1].length,n.holes.push(r))}return n};var P=t.exports;function B(e,t,n){var r=t[0],i=t[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var v=((e[0]-r)*o+(e[1]-i)*a)/(o*o+a*a);1<v?(r=n[0],i=n[1]):0<v&&(r+=o*v,i+=a*v)}return(o=e[0]-r)*o+(a=e[1]-i)*a}function i(e,t){var n=e.length-1,r=[e[0]];return function e(t,n,r,i,o){for(var a,v=i,h=n+1;h<r;h++){var u=B(t[h],t[n],t[r]);v<u&&(a=h,v=u)}i<v&&(1<a-n&&e(t,n,a,i,o),o.push(t[a]),1<r-a&&e(t,a,r,i,o))}(e,0,n,t,r),r.push(e[n]),r}function F(e,t,n){if(e.length<=2)return e;var r=void 0!==t?t*t:1;return e=i(e=n?e:function(e,t){for(var n,r,i,o,a,v=e[0],h=[v],u=1,l=e.length;u<l;u++)n=e[u],i=v,o=(r=n)[0]-i[0],a=r[1]-i[1],t<o*o+a*a&&(h.push(n),v=n);return v!==n&&h.push(n),h}(e,r),r)}function X(e,t){return e[0]*t[0]+e[1]*t[1]}function Y(e,t){var n=t[0],r=t[1],i=Math.sqrt(n*n+r*r);return e[0]=n/i,e[1]=r/i,e}function O(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function j(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}var L=[];function xe(e,t,n,r){var i,o,a,v,h,u,l,x,f,s,p,c=(o=n,(i=t)[0]*o[0]+i[1]*o[1]+i[2]*o[2]),y=Math.acos(c)*r;return O(L,n,t,-c),h=(v=a=L)[0],u=v[1],l=v[2],x=Math.sqrt(h*h+u*u+l*l),a[0]=h/x,a[1]=u/x,a[2]=l/x,f=e,s=t,p=Math.cos(y),f[0]=s[0]*p,f[1]=s[1]*p,f[2]=s[2]*p,O(e,e,L,Math.sin(y)),e}function V(e,t,n){if(n-t<3)return 0;for(var r=0,i=2*(n-1),o=2*t;o<2*n;){var a=e[i],v=e[i+1],h=e[o],u=e[o+1];i=o,o+=2,r+=a*u-h*v}return r}function T(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2;return P(e,t,n)}var $=[],ee=[],te=[];function k(e,t,n,r,i,o,a,v,h){var u,l,x,f=null!=a,s=i,p=null;f&&(p=new Uint32Array(r-n));for(var c,y,d,g,m,M,b,w,S,Z,z,R,A,q,P=[],B=n;B<r;B++){var F=B===r-1?n:B+1,O=B===n?r-1:B-1,j=e[2*O],L=e[2*O+1],V=e[2*B],T=e[2*B+1],k=e[2*F],U=e[2*F+1];$[0]=V-j,$[1]=T-L,ee[0]=k-V,ee[1]=U-T,Y($,$),Y(ee,ee),f&&(p[B]=s);var W=!1,E=void 0,I=void 0;if(v||B!==n)if(v||B!==r-1){A=ee,q=$,(R=te)[0]=A[0]+q[0],R[1]=A[1]+q[1];var _=te[1];te[1]=-te[0],te[0]=_,Y(te,te);var D=X(te,ee),G=Math.sqrt(1-D*D),J=o*Math.min(10,1/G);if(f&&a<1/G&&o*D<0){var N=V+te[0]*o,C=T+te[1]*o,H=Math.acos(G)/2,K=Math.tan(H)*Math.abs(o);t[2*s]=N+te[1]*K,t[2*s+1]=C-te[0]*K,t[2*++s]=N-te[1]*K,t[2*s+1]=C+te[0]*K,s++}else E=V+te[0]*J,I=T+te[1]*J,W=!0;if(W){if(h&&null!=u){var Q=(void(w=0),z=((S=E-(m=V))*((y=L)-(M=T))-(Z=I-M)*((c=j)-m))/(Z*((d=u)-c)-S*((g=l)-y)),(b=P)&&(b[w=w||0]=c+z*(d-c),b[w+1]=y+z*(g-y)),z);-.01<=Q&&Q<=1.01&&(t[2*x]=E=P[0],t[2*x+1]=I=P[1])}u=t[2*s]=E,l=t[2*s+1]=I,x=s,s++}}else te[0]=$[1],te[1]=-$[0],Y(te,te),E=V+te[0]*o,I=T+te[1]*o,W=!0;else te[0]=ee[1],te[1]=-ee[0],Y(te,te),u=t[2*s]=V+te[0]*o,l=t[2*s+1]=T+te[1]*o,x=s,s++}return p}function U(e,t,n,r,i){var o=null!=r?[]:new Float32Array(e.length);if(k(e,o,0,t&&t.length?t[0]:e.length/2,0,n,r,i,!0),t)for(var a=0;a<t.length;a++){var v=t[a];k(e,o,v,t[a+1]||e.length/2,null!=r?o.length/2:v,n,r,i,!1)}return o}function W(e,t,n,r){for(var i=0;i<Math.floor((r-n)/2);i++)for(var o=0;o<t;o++){var a=(i+n)*t+o,v=(r-i-1)*t+o,h=e[a];e[a]=e[v],e[v]=h}return e}function E(e,t){var n=e.length/2,r=0,i=t&&t.length?t[0]:n;0<V(e,r,i)&&W(e,2,r,i);for(var o=1;o<(t?t.length:0)+1;o++)V(e,r=t[o-1],i=t[o]||n)<0&&W(e,2,r,i)}function I(e){e.depth=e.depth||1,e.bevelSize=e.bevelSize||0,e.bevelSegments=null==e.bevelSegments?2:e.bevelSegments,e.smoothBevel=e.smoothBevel||!1,e.simplify=e.simplify||0,null==e.smoothSide&&(e.smoothSide="auto"),null==e.smoothSideThreshold&&(e.smoothSideThreshold=.9),"number"==typeof e.depth&&(e.bevelSize=Math.min(0<e.bevelSegments?e.bevelSize:0,e.depth/2)),0<e.bevelSize||(e.bevelSegments=0),e.bevelSegments=Math.round(e.bevelSegments);var t=e.boundingRect;if(e.translate=e.translate||[0,0],e.scale=e.scale||[1,1],e.fitRect){var n=null==e.fitRect.x?t.x||0:e.fitRect.x,r=null==e.fitRect.y?t.y||0:e.fitRect.y,i=e.fitRect.width,o=e.fitRect.height;null==i?null!=o?i=o/t.height*t.width:(i=t.width,o=t.height):null==o&&(o=i/t.width*t.height),e.scale=[i/t.width,o/t.height],e.translate=[(n-t.x)*e.scale[0],(r-t.y)*e.scale[1]]}}var fe=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function _(e,t,n,r,i,o){var a=t.vertices,v=t.topVertices,h=t.splittedMap,u=t.depth,l=t.rect,x=r-n,f=o.smoothBevel?1:2,s=Math.min(u/2,o.bevelSize),p=o.bevelSegments,c=i.vertex,y=Math.max(l.width,l.height,u),d=h?function(e){var t=(e+1)%x;return h[e+n]===h[t+n]}:function(e){return!1};if(0<s)for(var g=[0,0,1],m=[],M=[0,0,-1],b=[],w=0,S=new Float32Array(x),Z=0;Z<2;Z++)for(var z=0===Z?u-s:s,R=0;R<=p*f;R++){for(var A=0,q=void 0,P=void 0,B=0;B<x;B++){var F=2*(B%x+n),O=h?2*h[F/2]:F;m[0]=a[F]-v[O],m[1]=a[F+1]-v[O+1],m[2]=0;var j=Math.sqrt(m[0]*m[0]+m[1]*m[1]);m[0]/=j,m[1]/=j;var L=(Math.floor(R/f)+R%f)/p;0===Z?xe(b,g,m,L):xe(b,m,M,L);var V=0===Z?L:1-L,T=s*Math.sin(V*Math.PI/2),k=j*Math.cos(V*Math.PI/2),U=s*j/Math.sqrt(T*T+k*k),W=b[0]*U+v[O],E=b[1]*U+v[O+1],I=b[2]*U+z;if(e.position[3*i.vertex]=W,e.position[3*i.vertex+1]=E,e.position[3*i.vertex+2]=I,0<B&&(A+=Math.sqrt((q-W)*(q-W)+(P-E)*(P-E))),0<R||0<Z){var _=3*(i.vertex-x),D=e.position[_],G=e.position[_+1],J=e.position[_+2];S[B]+=Math.sqrt((D-W)*(D-W)+(G-E)*(G-E)+(J-I)*(J-I))}if(e.uv[2*i.vertex]=A/y,e.uv[2*i.vertex+1]=S[B]/y,q=W,P=E,i.vertex++,!d(B)&&(1<f&&R%f||1===f&&1<=R))for(var N=0;N<6;N++){var C=(fe[N][0]+B)%x,H=fe[N][1]+w;e.indices[i.index++]=(H-1)*x+C+c}}w++}else for(var K=0;K<2;K++)for(var Q=0===K?u:0,X=0,Y=void 0,$=void 0,ee=0;ee<x;ee++){var te=2*(ee+n),ne=a[te],re=a[te+1],ie=3*i.vertex,oe=2*i.vertex;e.position[ie]=ne,e.position[ie+1]=re,e.position[ie+2]=Q,0<ee&&(X+=Math.sqrt((Y-ne)*(Y-ne)+($-re)*($-re))),e.uv[oe]=X/y,e.uv[oe+1]=Q/y,Y=ne,$=re,i.vertex++}for(var ae=0<s?p*f+1:1,ve=0;ve<x;ve++)if(!d(ve))for(var he=0;he<6;he++){var ue=(fe[he][0]+ve)%x,le=fe[he][1]+ae;e.indices[i.index++]=(le-1)*x+ue+c}}function D(e,t,n,r){var i=e.indices,o=e.topVertices,a=e.rect,v=e.depth;if(!(o.length<=4)){for(var h=n.vertex,u=i.length,l=0;l<u;l++)t.indices[n.index++]=h+i[l];for(var x=Math.max(a.width,a.height),f=0;f<(r.excludeBottom?1:2);f++)for(var s=0;s<o.length;s+=2){var p=o[s],c=o[s+1],y=3*n.vertex,d=2*n.vertex;t.position[y]=p,t.position[y+1]=c,t.position[y+2]=(1-f)*v,t.uv[d]=(p-a.x)/x,t.uv[d+1]=(c-a.y)/x,n.vertex++}if(!r.excludeBottom)for(var g=o.length/2,m=0;m<u;m+=3)for(var M=0;M<3;M++)t.indices[n.index++]=h+g+i[m+2-M]}}function G(e,t,n,r){var i=null==n||"auto"===n;if(!0===n)return{vertices:e,holes:t};for(var o=[],a=t&&[],v=e.length/2,h=[],u=[],l=[],x=0,f=0,s=(t?t.length:0)+1,p=0;p<s;p++){0===p?f=t&&t.length?t[0]:v:(x=t[p-1],f=t[p]||v);for(var c=x;c<f;c++){var y=e[2*c],d=e[2*c+1],g=c===f-1?x:c+1,m=e[2*g],M=e[2*g+1];if(i){var b=c===x?f-1:c-1,w=e[2*b],S=e[2*b+1];h[0]=w-y,h[1]=S-d,u[0]=m-y,u[1]=M-d,Y(h,h),Y(u,u),r<1-(.5*X(h,u)+.5)?(o.push(y,d),l.push(c)):(o.push(y,d,y,d),l.push(c,c))}else o.push(y,d,y,d),l.push(c,c)}p<s-1&&a&&a.push(o.length/2)}return{vertices:new Float32Array(o),splittedMap:l,holes:a}}function J(e,t){for(var n=0,r=0,i=0;i<e.length;i++){var o=e[i],a=o.indices,v=o.vertices,h=o.splittedMap,u=o.topVertices,l=o.holes,x=o.depth,f=0<Math.min(x/2,t.bevelSize)?t.bevelSegments:0;l=l||[],n+=a.length*(t.excludeBottom?1:2),r+=u.length/2*(t.excludeBottom?1:2);for(var s=2+2*f,p=0,c=0,y=0;y<l.length+1;y++){0===y?c=l.length?l[0]:v.length/2:(p=l[y-1],c=l[y]||v.length/2),n+=6*((h?h[c-1]+1:c)-(h?h[p]:p))*(s-1);var d=c-p;r+=d*s+(t.smoothBevel?0:f*d*2)}}for(var g={position:new Float32Array(3*r),indices:new(65535<r?Uint32Array:Uint16Array)(n),uv:new Float32Array(2*r)},m={vertex:0,index:0},M=0;M<e.length;M++)D(e[M],g,m,t);for(var b=0;b<e.length;b++){var w=e[b],S=w.holes,Z=w.vertices.length/2,z=0,R=S&&S.length?S[0]:Z;if(_(g,e[b],z,R,m,t),S)for(var A=0;A<S.length;A++)z=S[A],R=S[A+1]||Z,_(g,e[b],z,R,m,t)}for(var q=0;q<g.uv.length;q++){var P=g.uv[q];0<P&&Math.round(P)===P?g.uv[q]=1:g.uv[q]=P%1}return g.normal=function(e,t){function n(e,t,n,r){e[0]=t,e[1]=n,e[2]=r}for(var r,i,o,a,v,h,u,l,x,f,s,p,c,y,d,g=[],m=[],M=[],b=[],w=[],S=[],Z=e.length,z=new Float32Array(t.length),R=0;R<Z;){var A=3*e[R++],q=3*e[R++],P=3*e[R++];n(g,t[A],t[A+1],t[A+2]),n(m,t[q],t[q+1],t[q+2]),n(M,t[P],t[P+1],t[P+2]),j(b,g,m),j(w,m,M),r=S,o=w,a=(i=b)[0],v=i[1],h=i[2],u=o[0],l=o[1],x=o[2],r[0]=v*x-h*l,r[1]=h*u-a*x,r[2]=a*l-v*u;for(var B=0;B<3;B++)z[A+B]=z[A+B]+S[B],z[q+B]=z[q+B]+S[B],z[P+B]=z[P+B]+S[B]}for(var F=0;F<z.length;)n(S,z[F],z[F+1],z[F+2]),p=(s=f=S)[0],c=s[1],y=s[2],d=Math.sqrt(p*p+c*c+y*y),f[0]=p/d,f[1]=c/d,f[2]=y/d,z[F++]=S[0],z[F++]=S[1],z[F++]=S[2];return z}(g.indices,g.position),g.boundingRect=e[0]&&e[0].rect,g}function N(e,t,n){for(var r=n.lineWidth,i=e.length,o=new Float32Array(2*i),a=n.translate||[0,0],v=n.scale||[1,1],h=0,u=0;h<i;h++)o[u++]=e[h][0]*v[0]+a[0],o[u++]=e[h][1]*v[1]+a[1];V(o,0,i)<0&&W(o,2,0,i);var l=[],x=[],f=n.miterLimit,s=k(o,x,0,i,0,-r/2,f,!1,!0);W(o,2,0,i);for(var p=k(o,l,0,i,0,-r/2,f,!1,!0),c=(l.length+x.length)/2,y=new Float32Array(2*c),d=0,g=x.length/2,m=0;m<x.length;m++)y[d++]=x[m];for(var M=0;M<l.length;M++)y[d++]=l[M];for(var b=new(65535<c?Uint32Array:Uint16Array)(3*(2*(i-1)+(c-2*i))),w=0,S=0;S<i-1;S++){var Z=S+1;b[w++]=g-1-s[S],b[w++]=g-1-s[S]-1,b[w++]=p[S]+1+g,b[w++]=g-1-s[S],b[w++]=p[S]+1+g,b[w++]=p[S]+g,p[Z]-p[S]==2?(b[w++]=p[S]+2+g,b[w++]=p[S]+1+g,b[w++]=g-s[Z]-1):s[Z]-s[S]==2&&(b[w++]=p[Z]+g,b[w++]=g-1-(s[S]+1),b[w++]=g-1-(s[S]+2))}var z=0<n.bevelSize?U(y,[],n.bevelSize,null,!0):y,R=n.boundingRect,A=G(y,null,n.smoothSide,n.smoothSideThreshold);return{vertices:A.vertices,rawVertices:vertices,splittedMap:A.splittedMap,indices:b,topVertices:z,rect:{x:R.x*v[0]+a[0],y:R.y*v[1]+a[1],width:R.width*v[0],height:R.height*v[1]},depth:"function"==typeof n.depth?n.depth(t):n.depth,holes:[]}}function C(e,t){for(var n=[],r=0;r<e.length;r++){for(var i=e[r],o=[],a=i.length,v=i[a-1][0],h=i[a-1][1],u=0,l=0;l<a;l++){var x=i[l][0],f=i[l][1],s=x-v,p=f-h;t<(u+=Math.sqrt(s*s+p*p))&&(o.push(i[l]),u=0),v=x,h=f}3<=o.length&&n.push(o)}return 0<n.length?n:null}function H(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];3<=(i=F(i,t,!0)).length&&n.push(i)}return 0<n.length?n:null}function K(e,t){t=Object.assign({},t);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<e.length;i++)ne(e[i][0],n,r);t.boundingRect=t.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},I(t);for(var o=[],a=t.translate||[0,0],v=t.scale||[1,1],h=t.boundingRect,u={x:h.x*v[0]+a[0],y:h.y*v[1]+a[1],width:h.width*v[0],height:h.height*v[1]},l=Math.min(h.width,h.height)/1e5,x=0;x<e.length;x++){var f=C(e[x],l);if(f){var s=t.simplify/Math.max(v[0],v[1]);if(0<s&&(f=H(f,s)),f){for(var p=P.flatten(f),c=p.vertices,y=p.holes,d=p.dimensions,g=0;g<c.length;)c[g]=c[g++]*v[0]+a[0],c[g]=c[g++]*v[1]+a[1];if(E(c,y),2!==d)throw new Error("Only 2D polygon points are supported");var m=0<t.bevelSize?U(c,y,t.bevelSize,null,!0):c,M=T(m,y,d),b=G(c,y,t.smoothSide,t.smoothSideThreshold);o.push({indices:M,vertices:b.vertices,rawVertices:c,topVertices:m,holes:b.holes,splittedMap:b.splittedMap,rect:u,depth:"function"==typeof t.depth?t.depth(x):t.depth})}}}return J(o,t)}function Q(e,t){t=Object.assign({},t);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<e.length;i++)ne(e[i],n,r);t.boundingRect=t.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},I(t);var o=t.scale||[1,1];null==t.lineWidth&&(t.lineWidth=1),null==t.miterLimit&&(t.miterLimit=2);for(var a=[],v=0;v<e.length;v++){var h=e[v],u=t.simplify/Math.max(o[0],o[1]);0<u&&(h=F(h,u,!0)),a.push(N(h,v,t))}return J(a,t)}function ne(e,t,n){for(var r=0;r<e.length;r++)t[0]=Math.min(e[r][0],t[0]),t[1]=Math.min(e[r][1],t[1]),n[0]=Math.max(e[r][0],n[0]),n[1]=Math.max(e[r][1],n[1])}e.extrudeGeoJSON=function(t,e){e=Object.assign({},e);var n=[],r=[],i=[],o=[],a=[1/0,1/0],v=[-1/0,-1/0];"LineString"!==t.type&&"MultiLineString"!==t.type&&"Polygon"!==t.type&&"MultiPolygon"!==t.type||(t={features:[{geometry:t}]});for(var h=0;h<t.features.length;h++){var u=t.features[h].geometry;if(u&&u.coordinates)switch(u.type){case"LineString":n.push(u.coordinates),i.push(h),ne(u.coordinates,a,v);break;case"MultiLineString":for(var l=0;l<u.coordinates.length;l++)n.push(u.coordinates[l]),i.push(h),ne(u.coordinates[l],a,v);break;case"Polygon":r.push(u.coordinates),o.push(h),ne(u.coordinates[0],a,v);break;case"MultiPolygon":for(var x=0;x<u.coordinates.length;x++)r.push(u.coordinates[x]),o.push(h),ne(u.coordinates[x][0],a,v)}}e.boundingRect=e.boundingRect||{x:a[0],y:a[1],width:v[0]-a[0],height:v[1]-a[1]};var f=e.depth;return{polyline:Q(n,Object.assign(e,{depth:function(e){return"function"==typeof f?f(t.features[i[e]]):f}})),polygon:K(r,Object.assign(e,{depth:function(e){return"function"==typeof f?f(t.features[o[e]]):f}}))}},e.extrudePolygon=K,e.extrudePolyline=Q,e.flatten=function(e){return P.flatten(e)},e.offsetPolygon=U,e.triangulate=T,Object.defineProperty(e,"__esModule",{value:!0})});
